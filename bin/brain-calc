#!/usr/bin/env php
<?php
$autoloadPath1 = __DIR__ . '/../../../autoload.php';
$autoloadPath2 = __DIR__ . '/../vendor/autoload.php';

if (file_exists($autoloadPath1)) {
    require_once $autoloadPath1;
} else {
    require_once $autoloadPath2;
}

use function cli\line;
use function cli\prompt;

//There we say Hello and ask user's name
line('Welcome to the Brain Game!');
$name = prompt('May I have your name?');
line("Hello, %s!", $name);
line('Answer "yes" if the number is even, otherwise answer "no".');

//form data for game
function dataOfTask() :array
{
    $mathOperators = ["+" , "-", "*"];
    $valueForMathExpr1 = rand(1, 100);
    $valueForMathExpr2 = rand(1, 100);
    $currentOperator = $mathOperators[array_rand($mathOperators)];
    $question = "{$valueForMathExpr1} {$currentOperator} {$valueForMathExpr2}";
    $rightAnswer = null;
    switch ($currentOperator) {
        case "+":
            $rightAnswer = $valueForMathExpr1 + $valueForMathExpr2;
            break;
        case "-":
            $rightAnswer = $valueForMathExpr1 - $valueForMathExpr2;
            break;
        case "*":
            $rightAnswer = $valueForMathExpr1 * $valueForMathExpr2;
            break;
    }
    return [$question, (string)$rightAnswer];
}
//process of the game
function game() :bool
{
    for ($i = 0, $numberOfTrying = 3; $i < $numberOfTrying; $i++) { //amount of attempts to win
        //talking with user and form data for checking
        [$question, $rightAnswer] = dataOfTask();
        line("Question: %s", $question);
        $userAnswer = prompt("Your answer");
        //checking the answer
        if ($rightAnswer === $userAnswer) {
            line("Correct!");
        } else {
            line("'{$userAnswer}' is wrong answer ;(. Correct answer was '{$rightAnswer}'.");
            return false;
        }
    }
    return true;
}

$congratulationsText = (game()) ? "Congratulations, %s!" : "Let's try again, %s!";
line($congratulationsText, $name);
